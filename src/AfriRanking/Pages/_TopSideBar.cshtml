@using ModelData.Services;
@inject ICategoryServices CategoryServices
@inject IPostServices PostServices
@inject IAdvertService AdvertServices


@{ 
    List<ModelData.Models.Advert> itemAdert = await AdvertServices.GetAdvertsAsync();
    List<ModelData.Models.Post> itemPost = await PostServices.GetPublishedPosts(showInHero: true);

}

<div class="ne-sidebar sidebar-break-md col-lg-4 col-md-12">

    <div class="sidebar-box">
        <div class="ne-banner-layout1 text-center">
            @{
                ModelData.Models.Advert sideadvert = itemAdert.FirstOrDefault(x => x.Position == ModelData.Models.AdvertPosition.SidebarTop);
            }
            @if (sideadvert != null)
            {
                <a href="@sideadvert.Link" target="_blank">
                    <img src="@sideadvert.ImageUrl" alt="@sideadvert.Title" class="img-fluid">
                </a>
            }

        </div>
    </div>
    <div class="sidebar-box">
        <div class="topic-border color-scampi mb-5 recent-01-news">
            <div class="topic-box-lg color-scampi">Recent News</div>
        </div>
        <div class="row">
            @{
                // Get the 4 most recent posts
                var recentPosts = (await PostServices.GetRecentPosts()) // Or GetPosts() depending on your service
                                    .OrderByDescending(p => p.PublishedAt ?? p.Date)
                                    .Take(8)
                                    .ToList();
            }

            @foreach (var post in recentPosts)
            {
                var imageUrl = post.PostImages?.FirstOrDefault(pi => pi.IsDefault)?.ImageUrl ?? "~/assets/default.jpg";

                <div class="col-lg-6 col-md-6 col-sm-6 col-6 mb-3">
                    <div class="recent-01-news border rounded p-2 h-100">
                        <a asp-page="/PostPage" asp-route-slug="@post.Slug" class="d-block mb-2" style="aspect-ratio: 1/1;">
                            <div style="
    width: 100%;
    height: 100%;
    background-image: url('@Url.Content(imageUrl)');
    background-size: cover;
    background-position: center;
    border-radius: 5px;">
                            </div>
                        </a>
                        <h3 class="title-medium-dark size-md mb-0" style="font-size: 0.9rem; line-height: 1.2;">
                            <a asp-page="/PostPage" asp-route-slug="@post.Slug">@post.Title</a>
                        </h3>
                    </div>
                </div>


            }
        </div>
    </div>
</div>