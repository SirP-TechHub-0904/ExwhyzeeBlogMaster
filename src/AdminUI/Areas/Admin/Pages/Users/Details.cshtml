@page "{id}"
@model AdminUI.Areas.Admin.Pages.Users.DetailsModel
@{
    ViewData["Title"] = "User Details";
}

<h2>User Details</h2>

<div class="card p-3 mb-3">
    <h5><strong>Email:</strong> @Model.AppUser.Email</h5>
    <p><strong>User Name:</strong> @Model.AppUser.UserName</p>
    <p><strong>Email Confirmed:</strong> @(Model.AppUser.EmailConfirmed ? "Yes" : "No")</p>
    <p><strong>Lockout Enabled:</strong> @(Model.AppUser.LockoutEnabled ? "Yes" : "No")</p>
</div>
<div class="card p-3 mb-3">
    <h5><strong>🔗 Generate Password Reset Link</strong></h5>
    <p><strong>Instruction:</strong> Click the button below to generate a unique password reset link for this user. Share the link with the user so they can create a new password and access their account.</p>

    <a asp-page-handler="GenerateResetLink" asp-route-id="@Model.AppUser.Id" class="btn btn-warning">
        Generate Reset Link
    </a>

    @if (TempData["ResetLink"] != null)
    {
        <input type="hidden" id="resetLink" value="@TempData["ResetLink"]" />

        <div class="card p-3 bg-light border mt-3">
            <pre class="mb-0" style="white-space: pre-wrap; font-family: inherit;">
Hello @Model.AppUser.FullName,

Your account has been created successfully. Please click the link below to create your password and access your account:

🔗 Create Your Password:
@TempData["ResetLink"]

⚠️ Note: This link will expire on @TempData["ExpiryDate"].

Once you have created your password, you can log in using your email address.

Thank you!
        </pre>

            <div class="mt-3">
                <button class="btn btn-primary" type="button" onclick="copyResetMessage()">Copy Message</button>
            </div>
        </div>

        <script>
        function copyResetMessage() {
            const resetLink = document.getElementById("resetLink").value;
            const message = `Hello @Model.AppUser.FullName,

Your account has been created successfully. Please click the link below to create your password and access your account:

🔗 Create Your Password:
${resetLink}

⚠️ Note: This link will expire on @TempData["ExpiryDate"].

Once you have created your password, you can log in using your email address.

Thank you!`;

            navigator.clipboard.writeText(message);
            alert("The full message has been copied!");
        }
        </script>
    }

</div>
<div class="card p-3 mb-3">
    <h5><strong>User Roles</strong></h5>
    @if (Model.UserRoles.Count == 0)
    {
        <p class="text-muted">No roles assigned.</p>
    }
    else
    {
        <ul class="list-group mb-3">
            @foreach (var role in Model.UserRoles)
            {
                <li class="list-group-item">@role</li>
            }
        </ul>
    }
</div>
<a asp-page="Index" class="btn btn-secondary">Back to Users</a>
