@page "{id:int}"
@model AdminUI.Areas.Admin.Pages.Forms.ResponsesModel
@{
    ViewData["Title"] = $"Responses - {Model.Form.Title}";
}

<h2>Responses for: @Model.Form.Title</h2>

@if (Model.Form.Responses.Any())
{
    <table class="table table-bordered table-hover">
        <thead class="table-light">
            <tr>
                <th>#</th>
                @if (!Model.Form.AllowAnonymousResponses)
                {
                    <th>Name</th>
                    <th>Email</th>
                }

                <th>Date</th>
                @foreach (var field in Model.Form.Fields)
                {
                    <th>@field.Label</th>
                }
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.Form.Responses.Count; i++)
            {
                var response = Model.Form.Responses.ElementAt(i);
                <tr>
                    <td>@(i + 1)</td>
                    @if (!Model.Form.AllowAnonymousResponses)
                    {
                        if (!string.IsNullOrEmpty(response.UserId) && Model.UserDetails.TryGetValue(response.UserId, out var details))
                        {
                            <td>@details.Name</td>
                            <td>@details.Email</td>
                        }
                         
                    }

                    <td>@response.SubmittedAt.ToLocalTime().ToString("g")</td>
                    @foreach (var field in Model.Form.Fields)
                    {
                        var value = response.FieldValues.FirstOrDefault(f => f.FieldId == field.Id)?.Value;
                        <td>@value</td>
                    }
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>No submissions found.</p>
}
